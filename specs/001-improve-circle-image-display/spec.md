# Feature Specification: サークル詳細ページ画像表示改善

**Feature Branch**: `001-improve-circle-image-display`
**Created**: 2026-01-24
**Status**: Draft
**Input**: User description: "サークル詳細ページの画像表示の改善
サークルカット、お品書きがある一定のサイズを超えている、スマホでの表示が崩れる
お品書きが1枚しか登録できない（複数枚用意しているユーザーに対応できない）"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - モバイルでサークル画像を正しく表示 (Priority: P1)

イベント参加者がスマートフォンでサークル詳細ページを開いたとき、サークルカットとお品書きが画面に収まり、読みやすい形で表示される。

**Why this priority**: 現在のユーザーの大半がモバイルデバイスからアクセスしており、表示崩れは即座にユーザー体験を損なう最も深刻な問題。イベント当日の現地での利用が主要ユースケースであるため、モバイル対応は最優先課題。

**Independent Test**: スマートフォン（iOS/Android）の各種画面サイズで、大きな画像を含むサークル詳細ページを開き、画像が画面からはみ出さず、スクロールやピンチ操作なしで全体が確認できることを確認。

**Acceptance Scenarios**:

1. **Given** イベント参加者がスマートフォンでサークル詳細ページを開く、**When** サークルカット（2000x2000px）が表示される、**Then** 画像が画面幅に収まり、横スクロールが発生しない
2. **Given** イベント参加者がスマートフォンでサークル詳細ページを開く、**When** お品書き（5MB、3000x4000px）が表示される、**Then** 画像が画面幅に収まり、適切にリサイズされて表示される
3. **Given** イベント参加者がタブレット（768px幅）でサークル詳細ページを開く、**When** 複数の画像が表示される、**Then** すべての画像が画面に収まり、レイアウトが崩れない

---

### User Story 2 - 複数のお品書きを登録・閲覧 (Priority: P2)

サークル出展者が複数枚のお品書き画像をアップロードし、イベント参加者がそれらをスムーズに閲覧できる。

**Why this priority**: 多くのサークルが複数ページのお品書きを用意しており、1枚しか登録できない現状はサークル情報の不完全な掲載につながっている。モバイル表示の修正後に対応すべき重要な機能拡張。

**Independent Test**: サークル出展者アカウントで編集画面から3枚のお品書きをアップロードし、イベント参加者アカウントでサークル詳細ページを開いて3枚すべてが閲覧できることを確認。スワイプやボタンで次の画像に移動できることを確認。

**Acceptance Scenarios**:

1. **Given** サークル出展者が編集権限を持つ、**When** お品書き登録画面で3枚の画像を選択してアップロード、**Then** 3枚すべてが保存され、プレビューで確認できる
2. **Given** サークル詳細ページに3枚のお品書きが登録されている、**When** イベント参加者がページを開く、**Then** 1枚目が表示され、「次へ」ボタンまたはスワイプで2枚目、3枚目に移動できる
3. **Given** サークル出展者が3枚のお品書きを登録済み、**When** 新たに1枚追加アップロード、**Then** 4枚目として追加され、表示順序が保持される
4. **Given** サークル出展者がお品書きを3枚登録済み、**When** 2枚目を削除、**Then** 1枚目と3枚目のみが表示され、表示順序が詰められる

---

### User Story 3 - 大きな画像を効率的に読み込み (Priority: P3)

大容量の画像ファイルがアップロードされた場合でも、ページ読み込みが遅延せず、ユーザーがストレスなく閲覧できる。

**Why this priority**: ユーザー体験の向上には重要だが、P1とP2の機能が動作すれば最低限の価値は提供できる。パフォーマンス最適化として後回しにできる。

**Independent Test**: 10MBの高解像度お品書き画像を登録し、3G回線相当の低速ネットワーク環境でサークル詳細ページを開き、3秒以内に画像が表示開始されることを確認。

**Acceptance Scenarios**:

1. **Given** サークルに8MBのお品書きが登録されている、**When** イベント参加者が4G回線でページを開く、**Then** 3秒以内に画像の表示が開始される
2. **Given** サークルに高解像度画像（5000x7000px）が登録されている、**When** モバイルユーザーがページを開く、**Then** デバイスに適したサイズで画像が表示され、データ通信量が最小化される
3. **Given** サークルに4枚のお品書きが登録されている、**When** イベント参加者がページを開く、**Then** 1枚目のみが先に読み込まれ、2枚目以降は遅延読み込みされる

---

### Edge Cases

- **画像が登録されていない場合**: サークルカットまたはお品書きが未登録のとき、デフォルト画像またはプレースホルダーテキストを表示する
- **お品書きが0枚の場合**: 「お品書きはまだ登録されていません」というメッセージを表示する
- **超大容量画像（20MB以上）**: アップロード時にファイルサイズ制限エラーを表示し、推奨サイズ（10MB以下）を案内する
- **画像フォーマットが非対応の場合**: JPEG/PNG以外のフォーマット（BMP、TIFF等）がアップロードされた場合、エラーメッセージを表示する
- **ネットワークエラー**: 画像読み込み失敗時、「画像を読み込めませんでした」とリトライボタンを表示する
- **縦長画像と横長画像の混在**: 縦長・横長が混在するお品書きでも、すべて画面幅に収まるように自動調整する
- **画像の表示順序の変更**: サークル出展者が登録済み画像の順序を入れ替えられる（ドラッグ&ドロップまたは上下移動ボタン）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはサークルカットとお品書き画像をモバイル画面幅（320px〜768px）に適応させて表示しなければならない
- **FR-002**: システムはサークルごとに複数枚（最大4枚）のお品書き画像をサポートしなければならない
- **FR-003**: サークル出展者は編集画面から複数のお品書き画像を登録・削除・並べ替えできなければならない
- **FR-004**: システムはアップロードされた画像のファイルサイズを検証し、10MBを超える場合はエラーを表示しなければならない
- **FR-005**: イベント参加者はサークル詳細ページで登録されたすべてのお品書き画像をスワイプまたはボタン操作で閲覧できなければならない
- **FR-006**: システムは画像が未登録の場合、適切なプレースホルダーまたはメッセージを表示しなければならない
- **FR-007**: システムは画像フォーマット（JPEG、PNG、GIF、WebP）を検証し、非対応フォーマットはエラーを表示しなければならない
- **FR-008**: システムは複数のお品書きがある場合、何枚目を表示中かを示すインジケーター（例: 「2/5」）を表示しなければならない
- **FR-009**: システムは画像読み込みエラー時に、ユーザーにエラーメッセージとリトライ手段を提供しなければならない
- **FR-010**: システムは大きな画像を自動的にリサイズまたは最適化し、モバイルデバイスでの表示に適したサイズで配信しなければならない

### Key Entities

- **サークル (Circle)**: サークル詳細情報を表すエンティティ。サークルカット画像（1枚）、お品書き画像（複数枚、最大4枚）、その他のメタデータ（サークル名、配置等）を持つ
- **お品書き画像 (Menu Image)**: サークルが提供する頒布物の情報を示す画像。複数枚の登録が可能（最大4枚）で、表示順序、画像URL、ファイルサイズ、アップロード日時を属性として持つ
- **サークルカット (Circle Cut)**: サークルを代表する1枚の画像。画像URL、ファイルサイズ、アップロード日時を属性として持つ

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: モバイルユーザー（画面幅320px〜768px）の100%が、画像の横スクロールやレイアウト崩れなしにサークル詳細ページを閲覧できる
- **SC-002**: ユーザーはサークル詳細ページを開いてから3秒以内に最初の画像の閲覧を開始できる
- **SC-003**: サークル出展者は最大4枚のお品書き画像を登録でき、イベント参加者はすべての画像を閲覧できる
- **SC-004**: お品書き閲覧タスクの完了率が90%以上になる（「次へ」ボタンやスワイプで複数画像を閲覧できることをユーザーが理解できる）
- **SC-005**: 画像表示に関するユーザーからの問い合わせ・バグレポートが現状から50%以上削減される

## Assumptions

以下の前提で仕様を作成しています。必要に応じて調整可能です。

- **お品書き最大枚数**: Twitter画像投稿の最大枚数（4枚）に準じ、最大4枚を設定。サークル告知との一貫性を保ち、ユーザーにとって馴染みのある枚数制限とする
- **画像最大サイズ**: 標準的なWeb画像のベストプラクティスに基づき、10MBを上限とする。これにより大半の高解像度画像をカバーしつつ、パフォーマンスを維持
- **対応画像フォーマット**: JPEG、PNG、GIF、WebPを標準的なWebフォーマットとしてサポート
- **モバイル画面幅範囲**: 最小320px（iPhone SE等の小型デバイス）から768px（タブレット）までをモバイルとして定義
- **画像表示順序**: 登録順をデフォルトとし、サークル出展者が任意に並べ替え可能とする
- **ページ読み込み目標時間**: 標準的なモバイルWeb体験として3秒以内を目標値とする
