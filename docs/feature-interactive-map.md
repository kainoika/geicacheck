# インタラクティブマップ機能

## 📋 実装完了状況（2024年12月現在）

### ✅ 実装済み機能
- **ズーム・パン機能**: マウスホイール、ドラッグ操作完全対応
- **タッチ操作**: ピンチズーム、タッチパン、慣性スクロール対応
- **ブックマークピン表示**: カテゴリ別色分けとアイコン表示
- **サイドバー機能**: 統計、フィルター、リスト表示
- **サークル詳細ポップアップ**: ピンクリックで詳細情報表示
- **イベント切り替え**: geika-31/32対応完了
- **レスポンシブデザイン**: PC・タブレット・スマートフォン対応
- **Heroicons統一**: 絵文字からHeroiconsへの完全移行
- **Firestore連携**: リアルタイムブックマークデータ同期

## 📱 機能詳細

### 1. マップ表示機能
- **SVGマップ表示**: イベントごとのレイアウトをSVG形式で高品質表示
- **イベント切り替え**: ヘッダーのドロップダウンでげいか31/32を選択可能
- **自動マップ読み込み**: イベント変更時の自動SVG切り替え
- **エラーハンドリング**: 読み込み失敗時の再試行機能

### 2. ズーム・パン操作
#### PC操作
- **マウスホイール**: スムーズなズームイン/アウト
- **ドラッグ操作**: 直感的なマップ移動
- **コントロールボタン**: +/-/リセットボタン

#### スマートフォン・タブレット操作
- **ピンチズーム**: 2本指での拡大縮小
- **タッチパン**: 指によるマップ移動
- **慣性スクロール**: 自然な減速効果
- **マルチタッチ対応**: 同時操作の適切な処理

### 3. ブックマーク表示
#### ピン表示
- **カテゴリ別色分け**:
  - チェック予定: 青色（#0284c7）
  - 気になる: 黄色（#ca8a04）
  - 優先: 赤色（#dc2626）
- **Heroiconsアイコン**: 本・星・炎のSVGアイコン
- **ドロップシャドウ**: 視認性向上のためのシャドウ効果

#### リアルタイム同期
- **Firestore連携**: ブックマーク変更の即座反映
- **イベントフィルタリング**: 選択イベントのブックマークのみ表示
- **安全なデータアクセス**: エラー耐性のあるデータ処理

### 4. サイドバー機能
#### 統計表示
- **合計件数**: 現在のイベントのブックマーク総数
- **カテゴリ別件数**: チェック予定・気になる・優先の個別件数
- **視覚的表示**: カラーコード付きの統計ボックス

#### フィルター機能
- **カテゴリ選択**: チェックボックスによる表示切り替え
- **件数表示**: 各カテゴリの該当件数をバッジ表示
- **即座反映**: フィルター変更の瞬時適用

#### ブックマークリスト
- **サークル一覧**: 名前と配置番号の表示
- **クリック移動**: リスト項目クリックでマップ上の位置へ移動
- **ホバー効果**: マウスオーバー時のハイライト

#### レスポンシブ対応
- **デスクトップ**: 常時表示の固定サイドバー
- **モバイル**: スライドイン式のオーバーレイサイドバー
- **タブレット**: 画面サイズに応じた適応表示

### 5. サークル詳細ポップアップ
#### 表示内容
- **基本情報**: サークル名、読み仮名、配置番号
- **ジャンル情報**: タグ形式での複数ジャンル表示
- **説明文**: サークルの詳細説明
- **詳細リンク**: サークル詳細ページへの導線

#### デザイン
- **モーダル表示**: 中央配置のモーダルダイアログ
- **背景オーバーレイ**: クリックで閉じる半透明背景
- **閉じるボタン**: Heroiconsの×ボタン

## 🏗️ 技術仕様

### ファイル構成
```
pages/map/index.vue                    # メインマップページ
composables/useEventMap.ts            # SVGマップ管理
composables/useCircleMapping.ts       # サークル座標計算
data/mapConfigs.ts                    # 座標マッピング設定
public/map-geika31.svg                # げいか31会場マップ
public/map-geika32.svg                # げいか32会場マップ
```

### 使用技術スタック
- **Vue 3 Composition API**: リアクティブ状態管理
- **TypeScript**: 型安全な実装
- **Tailwind CSS**: ユーティリティファーストCSS
- **Firebase Firestore**: リアルタイムデータベース
- **Heroicons**: 統一されたSVGアイコンセット
- **CSS Transforms**: 高パフォーマンスなズーム・パン

### 座標マッピングシステム
#### エリア分類
- **カエリア（カ-01〜06）**: 特別配置上部エリア
- **みきエリア（み-01〜20）**: 特別配置メインエリア
- **アエリア（ア-01〜72）**: 通常配置上段エリア（3列構成）
- **ドエリア（ド-01〜72）**: 通常配置下段エリア（3列構成）

#### 座標データ構造
```typescript
interface CoordinateMapping {
  [key: string]: {
    x: number      // X座標
    y: number      // Y座標
    width: number  // 表示幅
    height: number // 表示高さ
  }
}
```

### データフロー
1. **初期化**: イベント情報とブックマークデータを並行取得
2. **マップ読み込み**: 選択イベントに応じたSVGファイル読み込み
3. **ピン描画**: ブックマークデータと座標マッピングからピン配置
4. **インタラクション**: ユーザー操作に応じたリアルタイム更新

## 🎨 ユーザーインターフェース

### デザイン原則
- **直感的操作**: 説明不要の自然な操作性
- **視覚的フィードバック**: 操作結果の明確な表示
- **アクセシビリティ**: 多様なユーザーへの配慮
- **パフォーマンス**: 60fps のスムーズな動作

### カラーパレット
- **プライマリ**: ピンク（#FF69B4）- ブランドカラー
- **セカンダリ**: グレー（#6B7280）- 中性色
- **アクセント**: カテゴリ別カラー（青・黄・赤）

### アイコンシステム
- **統一性**: Heroiconsによる一貫したデザイン
- **識別性**: 機能ごとの明確な区別
- **スケーラビリティ**: サイズ変更に対応した SVG

## 🔧 運用・メンテナンス

### パフォーマンス最適化
- **SVGキャッシュ**: 一度読み込んだマップの再利用
- **効率的描画**: CSS Transform による GPU アクセラレーション
- **遅延読み込み**: 必要時のみのデータ取得

### エラーハンドリング
- **ネットワークエラー**: 再試行機能付きエラー表示
- **データ不整合**: 安全なフォールバック処理
- **ユーザビリティ**: 分かりやすいエラーメッセージ

### 今後の拡張計画
#### 短期改善
- **検索機能**: サークル名による検索とマップ移動
- **お気に入りグループ**: ブックマークのカスタム分類
- **印刷機能**: 配置マップの印刷対応

#### 長期改善
- **経路最適化**: 効率的な巡回ルート提案
- **混雑状況**: リアルタイム混雑度の可視化
- **AR対応**: 拡張現実による現地ナビゲーション

## 📊 利用統計・効果測定

### 想定効果
- **ユーザビリティ向上**: 直感的なマップ操作による満足度向上
- **時間短縮**: 効率的なサークル位置確認による巡回計画時間削減
- **アクセシビリティ**: モバイル対応による利用層拡大

### 測定指標
- **利用率**: マップページへのアクセス数
- **操作率**: ズーム・パン操作の頻度
- **滞在時間**: マップページでの平均滞在時間
- **エラー率**: 機能利用時のエラー発生率

## 📚 使用方法

### 基本操作
1. **アクセス**: メニューの「マップ」をクリック
2. **イベント選択**: 右上ドロップダウンからイベントを選択
3. **マップ操作**:
   - PC: マウスホイールでズーム、ドラッグで移動
   - モバイル: ピンチでズーム、ドラッグで移動
4. **ブックマーク確認**: サイドバーやマップ上のピンで位置確認
5. **詳細表示**: ピンクリックで詳細情報表示

### トラブルシューティング
#### マップが表示されない
- ブラウザキャッシュのクリア
- ページの再読み込み
- 別ブラウザでの確認

#### ブックマークが表示されない
- ログイン状態の確認
- ブックマーク存在の確認
- フィルター設定の確認

#### 動作が重い
- ハードウェアアクセラレーションの有効化
- 他タブの整理
- ブラウザの最新化

---

**最終更新**: 2024年12月  
**バージョン**: v1.0（フル実装完了）